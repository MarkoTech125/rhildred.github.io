<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="google-site-verification" content="dvUQ2S0TOifnI9P2ARoTiE_c6Bvfk6vS_zDJaQebe9o" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keywords" content="">
<link rel="shortcut icon" href="YinYang.ico">

<title>Rich: PROG1940</title>

<!-- Bootstrap core CSS -->
<link
	href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"
	rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
	<link href="//code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="css/main.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
      <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
    <![endif]-->
	<script
		src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
</head>

<body>


<div class="navbar navbar-inverse navbar-fixed-top">
	<div class="container PROG1940">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse"
				data-target=".navbar-collapse">
				<span class="icon-bar"></span> <span class="icon-bar"></span> <span
					class="icon-bar"></span>
			</button>
			<a class="navbar-brand" class="active" href=".">Faculty Page</a>
		</div>
		<div class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
				<li><a href="calendar.html">Calendar</a></li>
				<li><a href="contact.html">Contact</a></li>
				<li><a href="pastcourses.html">Courses</a></li>
			</ul>
			<form class="navbar-form navbar-right" action="searchResults.html"
				method="get">
				<div class="form-group">
					<input id="search" type="text" placeholder="search"
						class="form-control" autocomplete="off"
						name="q" />
				</div>
				<button type="submit" class="btn btn-success">
					<i class="icon-search"></i>&nbsp;&nbsp;Search
				</button>
			</form>
		</div>
		<!--/.navbar-collapse -->
	</div>
</div>

	<div class="container">
		<!-- Example row of columns -->
		<div class="row"><div class="editable" id="courses/PROG1940/PROG1940_md"><h1>Creating E-Commerce Web Sites with PHP and MySQL</h1>

<p>PHP is an incredibly useful server side programming language that is almost as ubiquitous as JavaScript on the client side. PHP is also used for popular content management systems like Wordpress and Drupal, so even if you don't program, you can still end up using php. In this course, I would like to look at some things like Drupal and Wordpress plugins as well as go through building some e-commerce directly in PHP.</p>

<table>
<thead>
<tr>
  <th>Dates</th>
  <th>material</th>
  <th>exercises</th>
</tr>
</thead>
<tbody>
<tr>
  <td>June 8-17</td>
  <td>my notes</td>
  <td>getting started with installation and basic building blocks of PHP, product catalog</td>
</tr>
<tr>
  <td>June 18-19, 24-27</td>
  <td>my notes</td>
  <td>contrasting Wordpress with slim app, building a theme and plugin</td>
</tr>
<tr>
  <td>June 22</td>
  <td>My notes</td>
  <td>final</td>
</tr>
<tr>
  <td>July 3</td>
  <td></td>
  <td>Project Presentations</td>
</tr>
</tbody>
</table>

<p>The project will be of your choosing, and can be done on wordpress or in php alone. You will need to pick something in which e-commerce is applicable, be it accepting donations or payments for products.</p>
</div><hr />
<div class="editable" id="articles/BuildingBlocks_md"><h1>Building Blocks of PHP</h1>

<p>PHP is a server-side scripting language designed for web development but also used as a general-purpose programming language. PHP is now installed on more than 244 million websites and 2.1 million web servers. Originally created by Rasmus Lerdorf in 1995, the reference implementation of PHP is now produced by The PHP Group. While PHP originally stood for Personal Home Page, it now stands for PHP: Hypertext Preprocessor, a recursive acronym. http://en.wikipedia.org/wiki/PHP</p>

<p>PHP can be included in web pages. So that it can easily be parsed with web pages PHP is delimited by <code>&lt;?php</code> and <code>?&gt;</code>. The closing <code>?&gt;</code> isn't strictly necessary at the end of a file. A "hello world" program in PHP looks like this:</p>

<pre><code>&lt;?php

    echo "Rich Rocks!";

?&gt;
</code></pre>

<p><code>echo</code> in this case writes what follows it into the output stream. Following the <code>echo</code> can be a list of things to be output as we shall see in the next example on variables.</p>

<p>PHP variables begin with a <code>$</code> dollar sign. For instance:</p>

<pre><code>&lt;?php
    $nOriginalPrice = 12.53;

    echo ($nOriginalPrice * 1.13), " is the price of ", $nOriginalPrice, " with 13% HST added\n";
?&gt;
</code></pre>

<p>A student showed me the "if this then that" iPhone app the other day. This is the PHP equivalent:</p>

<pre><code>&lt;?php
$nTestScore = 65;

if($nTestScore &lt; 55)
{
    echo "You failed \n";
}
elseif ($nTestScore &gt; 79)
{
    echo "You got an A \n";
}
else
{
    echo "You passed \n";
}
</code></pre>

<p>There is another decision making structure called a switch statement. A switch statement is useful for choosing from a number of discrete options.</p>

<p>To continue on with our test score idea:</p>

<pre><code>&lt;?php

$nTestScore = 'A';

switch($nTestScore)
{
    case 'A':
        echo "You got an a";

    case 'B':
        echo "Solid effort";
        break;

    case 'C':
        echo "You should have studied more";
        break;
    default:
        echo "You failed";
        break;
}
</code></pre>

<p>Doing things over and over is what computers do best! We looked at a couple of iterative or looping constructs:</p>

<pre><code>&lt;?php
for($i = 0; $i &lt; 10; $i++)
{
    echo $i, " is the next number \n";
}

?&gt;
</code></pre>

<p>While:</p>

<pre><code>&lt;?php
$i = 0;

while($i &lt; 0)
{
    echo $i, " was the next number for while \n";
    $i++;
}


$i = 0;

do
{
    echo $i, " was the next number for do while \n";
    $i++;

}
while($i &lt; 0);

?&gt;
</code></pre>

<p>We looked at simple PHP array literals, where we also learned about the <code>print_r</code> for outputting more complex structures:</p>

<pre><code>&lt;?php

$aStrings = ["string1", "string2", "string3"];

print_r($aStrings);
</code></pre>

<p>Then our attention turned to associative arrays. To create an associative array, both the key and the value are defined:</p>

<pre><code>&lt;?php
$aAssociative = [1 =&gt; "August", 0 =&gt; "March", 4 =&gt; "April", 256 =&gt; "May"];

print_r($aAssociative);

echo "\n";

echo "the month with the short-form 'ap' is ", $aAssociative[0];

echo "\n";

print_r(array_keys($aAssociative));
</code></pre>

<p>We finished up with objects, where we also looked at functions. Following is a simple class hierarchy:</p>

<pre><code>&lt;?php


class Animal
{
    public $sSound = "";
    public $sMethodOfReproduction = "";

    public function Animal()
    {

    }

}


class Sheep extends Animal
{
    public $sMethodOfReproduction = "live birth";
    public function Sheep()
    {
        $this-&gt;sSound = "baah";
    }
}


$oAnimal = new Animal();

print_r($oAnimal);

echo " was oAnimal \n";

$oDolly = new Sheep();

print_r($oDolly);

echo " was oDolly \n";
</code></pre>

<p>One thing that I forgot to talk about, that I will mention here is the idea of defining constants to improve the readability of your code. Here is an internationalization example from my github:</p>

<pre><code>&lt;?php

define("CHARACTERSET", "ISO-8859-1");
define("HELLO", "Localized Hello");
define("EXPLANATION", "This is an application that can change languages");

?&gt;
</code></pre>

<p>And en francais:</p>

<pre><code>&lt;?php

define("CHARACTERSET", "ISO-8859-1");
define("HELLO", "Bonjour localis&amp;eacute;e");
define("EXPLANATION", "Il s'agit d'une application qui permet de changer de langue");

?&gt;
</code></pre>

<p>Then in my web page I have:</p>

<pre><code>...
switch ($lang)
{
case "fr":
include("strings_fr.php");
break;

default: //default to english
include("strings_en.php");
break;
}

header("Content-Type: text/html;charset= " .CHARACTERSET);
header("Content-Language: " .$lang);
...
</code></pre>

<p>A simpler use case for a define is:</p>

<pre><code>&lt;?php
define("HSTRATE", .13);

$nPriceBefore = 12.95;

echo $nPriceBefore, " with HST is ", (HSTRATE + 1) * $nPriceBefore;
</code></pre>

<p>This concludes the basics of PHP. Next database!</p>
</div><hr />
<div id="database" class="bookmark">
<div class="editable" id="articles/Database_md"><h1>PHP Database</h1>

<p>The database we will be accessing with PHP and, through PHP, with JavaScript is MySQL.
MySQL is included as part of the Xampp. The MySQL server is started from the Xampp control panel.
To work with MySQL databases, we will use a web app called phpmyadmin. You get to phpmyadmin by surfing to
http://localhost/phpmyadmin.  You are faced with a page like this:</p>

<p><img src="images/phpMyAdmin.png" alt="phpMyAdmin" title="phpMyAdmin" /></p>

<p>phpMyAdmin is a GUI to perform the basic CRUD operations on a MySQL database. phpMyadmin can also import and export .sql files which is important.</p>

<h2>Connecting to a Database</h2>

<p>MySQL is a database server. To get at the data contained within it is necessary to form a connection to the server by providing a host name, port username and password.</p>

<p>PhpMyadmin uses some defaults to list the available databases down the left side of the screen. Programmatically, to connect to a database one does something like this:</p>

<pre><code>function getConnection() {
    $dbhost="127.0.0.1";
    $dbuser="root";
    $dbpass="";
    $dbname="directory";
    $dbh = new PDO("mysql:host=$dbhost;dbname=$dbname", $dbuser, $dbpass);
    $dbh-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    return $dbh;
}
</code></pre>

<p>Once connected we use the resulting $dbh to build and execute queries. Following is an example of a select (Read) query:</p>

<pre><code>function getModifiedEmployees($modifiedSince = "1000-01-01") {
    $sql = "select * from employee WHERE lastModified &gt; :modifiedSince";
    try {
        $db = getConnection();
        $stmt = $db-&gt;prepare($sql);
        $stmt-&gt;bindParam("modifiedSince", $modifiedSince);
        $stmt-&gt;execute();
        $employees = $stmt-&gt;fetchAll(PDO::FETCH_OBJ);

        echo json_encode($employees);

    } catch(PDOException $e) {
        echo '{"error":{"text":'. $e-&gt;getMessage() .'}}';
    } finally {
        $db = null;
    }
}
</code></pre>

<p>There are a couple of interesting new things in here. We replaced our print_r statements with json_encode in anticipation of database work, so that our database output could be read programmatically.</p>

<p>The really interesting part of this from a programmer's perspective is the <code>try</code> and <code>catch</code>. This construct is called structured exception handling. The basic idea is that we code the non-exceptional case in a block preceded by a try statement.
If an exception occurs then the catch code is executed, which in this case does some JSON formatted error reporting.</p>

<p>Try and catch also has a third verb <code>finally</code>, which happens when the try and possible catch are complete.</p>

<p>The select case is the most complex of the queries to deal with in PHP. Following is an example of a delete statement:</p>

<pre><code>&lt;?php
    /* Delete all rows from the FRUIT table */
    $del = $dbh-&gt;prepare('DELETE FROM fruit');
    try{
        $del-&gt;execute();

        /* Return number of rows that were deleted */
        print("Return number of rows that were deleted:\n");
        $count = $del-&gt;rowCount();
        echo '{"delete":{"rows":'. $count .'}}';
    } catch(PDOException $e) {
        echo '{"error":{"text":'. $e-&gt;getMessage() .'}}';
    } finally {
        $db = null;
    }
?&gt;
</code></pre>

<p>There is a pretty good <a href="http://php.net/manual/en/book.pdo.php">reference on PHP Data Objects (PDO) here.</a></p>
</div></div>
<hr />
<div id="parameters" class="bookmark">
<div class="editable" id="articles/Parameters_md"><h1>Parameters in PHP</h1>

<p>In our examples we were very careful to not parse parameters in SQL. The reason for this was:</p>

<p><img src="images/RedLight.jpg" alt="Red Light Camera SQL Injection" title="Red Light Camera SQL Injection" /></p>

<p>Rather than take parameters directly into our SQL using string concatenation we
prepared our SQL with <code>?</code> placeholders and used <code>$stmt-&gt;execute</code> with parameters
to complete the work. Our example is a little contrived however because we
didn't cover how to get parameters from the internet. Parameters come from the
internet in PHP in special variables <code>$_GET</code> and <code>$_POST</code> . $_GET and $_POST are arrays of name value parameter pairs. Following is an example that uses the $_GET array. Note the use of the <code>isset()</code> built-in PHP function to check for the existence of the key <code>Genre</code>.</p>

<pre><code>&lt;?php

//print_r($_GET);

$sGenre = '%';

if(isset($_GET['Genre']))
{
    $sGenre = $_GET['Genre'];
}

$db = new PDO("mysql:host=localhost;dbname=cds", "root", "");



$stmt = $db-&gt;prepare("SELECT * FROM cds WHERE genre LIKE CONCAT('%', ?, '%')");

$stmt-&gt;execute(array($sGenre));

$results = $stmt-&gt;fetchAll(PDO::FETCH_OBJ);

echo json_encode($results);


?&gt;
</code></pre>

<p>We can pass parameters to our php programs <code>$_GET</code> or <code>$_POST</code> array with a javascript program. We can also pass parameters to the <code>$_GET</code> array using the URL. For example, in our case, http://localhost:8000/buildingblocksofphp/php/goodparametersConcat.php?Genre=POP will retrieve all of the POP cds from the above script. Parameters can be used likewise to insert data into the database, although we are about to learn that <code>$_GET</code> isn't normally used for inserts.</p>

<pre><code>&lt;?php

try {
    if(!isset($_GET['title']) || !isset($_GET['arranger']) || !isset($_GET['genre']))
    {
        throw new Exception("missing information");
    }
    $sTitle = $_GET['title'];
    $sArranger = $_GET['arranger'];
    $sGenre = $_GET['genre'];
    $db = new PDO("mysql:host=localhost;dbname=cds", "root", "");


    $stmt = $db-&gt;prepare("INSERT INTO cds(title, arranger, genre) VALUES (?,?,?)");



    $stmt-&gt;execute(array($sTitle, $sArranger, $sGenre));

    $count = $stmt-&gt;rowCount();
    echo '{"insert":{"rows":'. $count .'}}';
}
catch(Exception $e)
{
    echo "{\"error\" : \"", $e-&gt;getMessage(), "\"}";
}

?&gt;
</code></pre>

<p>In this example we use exception handling to deal with missing parameters. First we <code>try</code> to just execute our code. If we don't have a title, arranger and genre to insert, we <code>throw</code> an error message. The error message is <code>caught</code> and we echo the error message in the same way that we would have echoed the count of rows inserted had we successfully inserted.</p>
</div></div>
<hr />
<div id="slim" class="bookmark">
<div class="editable" id="courses/PROG1940/slim_md"><h1>Slim Micro-Framework</h1>

<p>With Slim we also introduced the idea of composer.</p>
</div></div><hr />
<div id="migrations" class="bookmark">
<div class="editable" id="courses/PROG1940/migrations_md"><h1>Database Migrations</h1>

<p>Keep code in sync with database schema.</p>
</div></div><hr />
<div id="final" class="bookmark">
<div class="editable" id="courses/PROG1940/final_md"><h1>PHP Final</h1>

<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/North_season.jpg/220px-North_season.jpg" alt="Happy Longest Day!" title="Happy Longest Day!" /></p>

<p>This test is designed to draw your attention to the basics of PHP. The 15 question <a href="tests/prog1940final.htm">test is here</a>. Good Luck!</p>
</div></div>

</div>

		<hr>

		<footer>
			<p>&copy; Rich Hildred 2013-<script>document.write(new Date().getFullYear());</script></p>
		</footer>
	</div>
	<!-- /container -->


	<!-- Bootstrap core JavaScript
    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script
		src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
	<script
		src="//code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<script>
		jQuery("#search").autocomplete({
			source : "https://rich-hildred.rhcloud.com/Words"
		});
	</script>
	<script>
		(function(i, s, o, g, r, a, m) {
			i['GoogleAnalyticsObject'] = r;
			i[r] = i[r] || function() {
				(i[r].q = i[r].q || []).push(arguments)
			}, i[r].l = 1 * new Date();
			a = s.createElement(o), m = s.getElementsByTagName(o)[0];
			a.async = 1;
			a.src = g;
			m.parentNode.insertBefore(a, m)
		})(window, document, 'script',
				'//www.google-analytics.com/analytics.js', 'ga');

		ga('create', 'UA-45546538-1', 'rhildred.users.sourceforge.net');
		ga('send', 'pageview');
	</script>
</body>
</html>
